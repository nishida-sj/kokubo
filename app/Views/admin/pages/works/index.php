<?php
// ÁÆ°ÁêÜÁîªÈù¢ÂÆüÁ∏æ‰∏ÄË¶ß
?>

<!-- „Éö„Éº„Ç∏„Éò„ÉÉ„ÉÄ„Éº -->
<div class="page-header">
    <div class="page-header__left">
        <h1 class="page-title">ÊñΩÂ∑•ÂÆüÁ∏æÁÆ°ÁêÜ</h1>
        <p class="page-description">ÂÆüÁ∏æ„ÅÆËøΩÂä†„ÉªÁ∑®ÈõÜ„ÉªÂâäÈô§„ÇíË°å„Åà„Åæ„Åô</p>
    </div>
    <div class="page-header__right">
        <a href="<?= site_url('admin/works/create') ?>" class="btn btn--primary">
            Ôºã Êñ∞„Åó„ÅÑÂÆüÁ∏æ„ÇíËøΩÂä†
        </a>
    </div>
</div>

<!-- „Éï„Ç£„É´„Çø„Éº„ÉªÊ§úÁ¥¢ -->
<div class="card mb-3">
    <div class="card__content">
        <form action="<?= site_url('admin/works') ?>" method="GET" class="filter-form">
            <div class="filter-form__row">
                <!-- Ê§úÁ¥¢ -->
                <div class="filter-form__group">
                    <label class="form-label">Ê§úÁ¥¢</label>
                    <input type="text"
                           name="q"
                           value="<?= h($filters['search']) ?>"
                           placeholder="„Çø„Ç§„Éà„É´„ÄÅË™¨Êòé„ÄÅÊâÄÂú®Âú∞„ÅßÊ§úÁ¥¢..."
                           class="form-input">
                </div>

                <!-- „Ç´„ÉÜ„Ç¥„É™„Éº -->
                <div class="filter-form__group">
                    <label class="form-label">„Ç´„ÉÜ„Ç¥„É™„Éº</label>
                    <select name="category" class="form-select">
                        <option value="">„Åô„Åπ„Å¶</option>
                        <?php foreach ($categories as $category): ?>
                            <option value="<?= $category['id'] ?>"
                                    <?= ($filters['category'] == $category['id']) ? 'selected' : '' ?>>
                                <?= h($category['name']) ?>
                            </option>
                        <?php endforeach; ?>
                    </select>
                </div>

                <!-- „Çπ„ÉÜ„Éº„Çø„Çπ -->
                <div class="filter-form__group">
                    <label class="form-label">„Çπ„ÉÜ„Éº„Çø„Çπ</label>
                    <select name="status" class="form-select">
                        <option value="">„Åô„Åπ„Å¶</option>
                        <option value="published" <?= ($filters['status'] === 'published') ? 'selected' : '' ?>>ÂÖ¨Èñã‰∏≠</option>
                        <option value="draft" <?= ($filters['status'] === 'draft') ? 'selected' : '' ?>>‰∏ãÊõ∏„Åç</option>
                        <option value="featured" <?= ($filters['status'] === 'featured') ? 'selected' : '' ?>>„Åä„Åô„Åô„ÇÅ</option>
                    </select>
                </div>

                <!-- „ÇΩ„Éº„Éà -->
                <div class="filter-form__group">
                    <label class="form-label">‰∏¶„Å≥È†Ü</label>
                    <select name="sort" class="form-select">
                        <option value="created_at" <?= ($filters['sort'] === 'created_at') ? 'selected' : '' ?>>‰ΩúÊàêÊó•</option>
                        <option value="updated_at" <?= ($filters['sort'] === 'updated_at') ? 'selected' : '' ?>>Êõ¥Êñ∞Êó•</option>
                        <option value="title" <?= ($filters['sort'] === 'title') ? 'selected' : '' ?>>„Çø„Ç§„Éà„É´</option>
                        <option value="category_name" <?= ($filters['sort'] === 'category_name') ? 'selected' : '' ?>>„Ç´„ÉÜ„Ç¥„É™„Éº</option>
                    </select>
                </div>

                <div class="filter-form__group">
                    <label class="form-label">È†ÜÂ∫è</label>
                    <select name="order" class="form-select">
                        <option value="desc" <?= ($filters['order'] === 'desc') ? 'selected' : '' ?>>ÈôçÈ†Ü</option>
                        <option value="asc" <?= ($filters['order'] === 'asc') ? 'selected' : '' ?>>ÊòáÈ†Ü</option>
                    </select>
                </div>

                <!-- Ê§úÁ¥¢„Éú„Çø„É≥ -->
                <div class="filter-form__group">
                    <label class="form-label">&nbsp;</label>
                    <button type="submit" class="btn btn--primary">Áµû„ÇäËæº„Åø</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- ÂÆüÁ∏æ„É™„Çπ„Éà -->
<div class="card">
    <div class="card__header">
        <h3 class="card__title">
            ÂÆüÁ∏æ‰∏ÄË¶ß
            <span class="count">(<?= number_format($pagination['total']) ?>‰ª∂)</span>
        </h3>
        <?php if ($pagination['total'] > 0): ?>
            <div class="card__actions">
                <span class="text-small text-muted">
                    <?= number_format(($pagination['page'] - 1) * $pagination['perPage'] + 1) ?>-<?= number_format(min($pagination['page'] * $pagination['perPage'], $pagination['total'])) ?>‰ª∂„ÇíË°®Á§∫
                </span>
            </div>
        <?php endif; ?>
    </div>

    <?php if (!empty($works)): ?>
        <div class="card__content">
            <div class="table-responsive">
                <table class="table table--hover">
                    <thead>
                        <tr>
                            <th width="60">ÁîªÂÉè</th>
                            <th>„Çø„Ç§„Éà„É´</th>
                            <th width="120">„Ç´„ÉÜ„Ç¥„É™„Éº</th>
                            <th width="100">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                            <th width="100">‰ΩúÊàêÊó•</th>
                            <th width="120">Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody>
                        <?php foreach ($works as $work): ?>
                            <tr>
                                <td>
                                    <div class="work-thumb">
                                        <?php if (!empty($work['main_image'])): ?>
                                            <img src="<?= site_url($work['main_image']) ?>"
                                                 alt="<?= h($work['title']) ?>"
                                                 class="work-thumb__img">
                                        <?php else: ?>
                                            <div class="work-thumb__placeholder">üè†</div>
                                        <?php endif; ?>
                                    </div>
                                </td>
                                <td>
                                    <div class="work-title">
                                        <h4 class="work-title__text">
                                            <a href="<?= site_url('admin/works/' . $work['id'] . '/edit') ?>"
                                               class="work-title__link">
                                                <?= h($work['title']) ?>
                                            </a>
                                        </h4>
                                        <?php if (!empty($work['location'])): ?>
                                            <div class="work-title__meta">
                                                üìç <?= h($work['location']) ?>
                                            </div>
                                        <?php endif; ?>
                                        <?php if (!empty($work['description'])): ?>
                                            <div class="work-title__description">
                                                <?= h(truncate_text($work['description'], 60)) ?>
                                            </div>
                                        <?php endif; ?>
                                    </div>
                                </td>
                                <td>
                                    <span class="category-badge">
                                        <?= h($work['category_name']) ?>
                                    </span>
                                </td>
                                <td>
                                    <div class="status-badges">
                                        <?php if ($work['is_published']): ?>
                                            <span class="status status--published">ÂÖ¨Èñã‰∏≠</span>
                                        <?php else: ?>
                                            <span class="status status--draft">‰∏ãÊõ∏„Åç</span>
                                        <?php endif; ?>
                                        <?php if ($work['is_featured']): ?>
                                            <span class="status status--featured">„Åä„Åô„Åô„ÇÅ</span>
                                        <?php endif; ?>
                                    </div>
                                </td>
                                <td class="text-small text-muted">
                                    <?= format_date($work['created_at'], 'Y/m/d') ?>
                                </td>
                                <td>
                                    <div class="actions">
                                        <a href="<?= site_url('works/' . $work['slug']) ?>"
                                           target="_blank"
                                           class="action-btn action-btn--view"
                                           title="Ë°®Á§∫">
                                            üëÅ
                                        </a>
                                        <a href="<?= site_url('admin/works/' . $work['id'] . '/edit') ?>"
                                           class="action-btn action-btn--edit"
                                           title="Á∑®ÈõÜ">
                                            ‚úè
                                        </a>
                                        <a href="<?= site_url('admin/works/' . $work['id'] . '/delete') ?>"
                                           class="action-btn action-btn--delete confirm-delete"
                                           title="ÂâäÈô§">
                                            üóë
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        <?php endforeach; ?>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ -->
        <?php if ($pagination['totalPages'] > 1): ?>
            <div class="card__footer">
                <nav class="pagination">
                    <?php if ($pagination['hasPrev']): ?>
                        <?php
                        $prevParams = $_GET;
                        $prevParams['page'] = $pagination['page'] - 1;
                        if ($prevParams['page'] == 1) unset($prevParams['page']);
                        ?>
                        <a href="<?= site_url('admin/works?' . http_build_query($prevParams)) ?>"
                           class="pagination__link">Ââç„Å∏</a>
                    <?php endif; ?>

                    <?php
                    $startPage = max(1, $pagination['page'] - 2);
                    $endPage = min($pagination['totalPages'], $pagination['page'] + 2);
                    ?>

                    <?php for ($i = $startPage; $i <= $endPage; $i++): ?>
                        <?php
                        $pageParams = $_GET;
                        $pageParams['page'] = $i;
                        if ($i == 1) unset($pageParams['page']);
                        ?>
                        <?php if ($i == $pagination['page']): ?>
                            <span class="pagination__link is-active"><?= $i ?></span>
                        <?php else: ?>
                            <a href="<?= site_url('admin/works?' . http_build_query($pageParams)) ?>"
                               class="pagination__link"><?= $i ?></a>
                        <?php endif; ?>
                    <?php endfor; ?>

                    <?php if ($pagination['hasNext']): ?>
                        <?php
                        $nextParams = $_GET;
                        $nextParams['page'] = $pagination['page'] + 1;
                        ?>
                        <a href="<?= site_url('admin/works?' . http_build_query($nextParams)) ?>"
                           class="pagination__link">Ê¨°„Å∏</a>
                    <?php endif; ?>
                </nav>
            </div>
        <?php endif; ?>

    <?php else: ?>
        <div class="card__content">
            <div class="empty-state">
                <div class="empty-state__icon">üè†</div>
                <h3 class="empty-state__title">ÂÆüÁ∏æ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                <p class="empty-state__text">
                    <?php if (!empty($filters['search']) || !empty($filters['category']) || !empty($filters['status'])): ?>
                        Ê§úÁ¥¢Êù°‰ª∂„Å´‰∏ÄËá¥„Åô„ÇãÂÆüÁ∏æ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ<br>
                        <a href="<?= site_url('admin/works') ?>" class="link">„Åô„Åπ„Å¶„ÅÆÂÆüÁ∏æ„ÇíË°®Á§∫</a>
                    <?php else: ?>
                        „Åæ„Å†ÂÆüÁ∏æ„ÅåËøΩÂä†„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ<br>
                        ÊúÄÂàù„ÅÆÂÆüÁ∏æ„ÇíËøΩÂä†„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ
                    <?php endif; ?>
                </p>
                <a href="<?= site_url('admin/works/create') ?>" class="btn btn--primary">
                    ÂÆüÁ∏æ„ÇíËøΩÂä†
                </a>
            </div>
        </div>
    <?php endif; ?>
</div>

<style>
/* ÂÆüÁ∏æÁÆ°ÁêÜ‰∏ÄË¶ß„Éö„Éº„Ç∏Â∞ÇÁî®„Çπ„Çø„Ç§„É´ */

/* „Éö„Éº„Ç∏„Éò„ÉÉ„ÉÄ„Éº */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
    gap: 20px;
}

.page-title {
    font-size: 28px;
    font-weight: 700;
    color: var(--admin-text);
    margin: 0 0 4px 0;
}

.page-description {
    font-size: 14px;
    color: var(--admin-text-light);
    margin: 0;
}

/* „Éï„Ç£„É´„Çø„Éº„Éï„Ç©„Éº„É† */
.filter-form__row {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr 1fr auto;
    gap: 16px;
    align-items: end;
}

@media (max-width: 1024px) {
    .filter-form__row {
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }
}

@media (max-width: 768px) {
    .filter-form__row {
        grid-template-columns: 1fr;
    }

    .page-header {
        flex-direction: column;
        align-items: stretch;
    }
}

.filter-form__group {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

/* „Ç´„Ç¶„É≥„Éà */
.count {
    font-size: 14px;
    font-weight: 400;
    color: var(--admin-text-light);
}

/* ÂÆüÁ∏æ„Çµ„É†„Éç„Ç§„É´ */
.work-thumb {
    width: 50px;
    height: 50px;
    border-radius: var(--admin-radius);
    overflow: hidden;
    background-color: var(--admin-bg);
}

.work-thumb__img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.work-thumb__placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: var(--admin-text-muted);
}

/* ÂÆüÁ∏æ„Çø„Ç§„Éà„É´ */
.work-title__text {
    margin: 0 0 4px 0;
    font-size: 14px;
    font-weight: 600;
}

.work-title__link {
    color: var(--admin-text);
    text-decoration: none;
}

.work-title__link:hover {
    color: var(--admin-primary);
}

.work-title__meta {
    font-size: 12px;
    color: var(--admin-text-light);
    margin-bottom: 4px;
}

.work-title__description {
    font-size: 12px;
    color: var(--admin-text-muted);
    line-height: 1.4;
}

/* „Ç´„ÉÜ„Ç¥„É™„Éº„Éê„ÉÉ„Ç∏ */
.category-badge {
    display: inline-block;
    padding: 4px 8px;
    background-color: var(--admin-info);
    color: var(--admin-white);
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
}

/* „Çπ„ÉÜ„Éº„Çø„Çπ */
.status-badges {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

/* „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ */
.action-btn--view {
    background-color: var(--admin-info);
    color: var(--admin-white);
}

.action-btn--view:hover {
    background-color: #1976D2;
}

/* „ÉÜ„Éº„Éñ„É´„É¨„Çπ„Éù„É≥„Ç∑„Éñ */
.table-responsive {
    overflow-x: auto;
}

@media (max-width: 768px) {
    .table {
        font-size: 12px;
    }

    .table th,
    .table td {
        padding: 8px 4px;
    }

    .work-thumb {
        width: 40px;
        height: 40px;
    }

    .actions {
        flex-direction: column;
        gap: 4px;
    }

    .action-btn {
        width: 28px;
        height: 28px;
        font-size: 12px;
    }
}

/* Á©∫Áä∂ÊÖã */
.empty-state {
    text-align: center;
    padding: 60px 20px;
}

.empty-state__icon {
    font-size: 64px;
    margin-bottom: 20px;
    opacity: 0.5;
}

.empty-state__title {
    font-size: 20px;
    font-weight: 600;
    color: var(--admin-text);
    margin-bottom: 12px;
}

.empty-state__text {
    font-size: 14px;
    color: var(--admin-text-light);
    line-height: 1.6;
    margin-bottom: 24px;
}

.link {
    color: var(--admin-primary);
    text-decoration: none;
}

.link:hover {
    text-decoration: underline;
}
</style>